---
title: 编程的基础知识
tags: [编程风格]
---

### 什么才是java的基础知识？

https://xwjie.github.io/note/basic.html

近日里，很多人邀请我回答各种j2ee开发的初级问题，我无一都强调java初学者要先扎实自己的基础知识，那什么才是java的基础知识？又怎么样才算掌握了java的基础知识呢？这个问题还真值得仔细思考。

我做j2ee开发已经超过十载，作为过来人，心路历程估计和大家差不多。编码的前几年，很长一段时间觉得java简单，开发实现各种功能都很轻松，代码写起来根本不费劲（主要是因为写的代码都是一些功能业务逻辑）。但同时自己心里明白，自己其实没有什么水平，自己这3,4年以来学懂的东西就那么多，其他人几个月就可以学会，自己的竞争力在哪里？这种矛盾的心理，困扰了我非常长的时间，非常的苦恼！总有一种报国无门无处发力的感觉。

这个时期，热衷了使用各种框架，各种api，常以今天学习了某个api，组件，框架的使用就觉得自己学到了东西，设计模式也看过不止一次，但都没有啥感觉。**一方面很努力学习，一方面又觉得不踏实**，因为例如这个api我知道而你不知道，但我告诉你之后你就知道了，那我比你的优势在哪里呢？苦恼*2

过了很长一段这种惶惶不可终日的日子，决定自己要改变，改变的方向就是阅读自己用到的java相关的源代码，看看jdk是如何实现的。就从基本的数据结构看，然后看多线程相关，在学习前台等等。写的代码还是那些代码，代码还是那么简单，但我力求做到**知道代码背后的真相**，这就是我最开始努力的方向。于是不再把时间都花在追求各种新框架、新API的使用上，每天都花时间在看实现原理上。就这样过了大半年左右，终于不再迷茫，不会在觉得自己只懂api的使用，觉得自己没有那么肤浅了，说脱胎换骨也不为过。那段时间，是我成长最快的时期，也是最充实的一段时光。

**Talk is cheap，show me the code**。举例说明大家会比较有感觉。

如学习了hashmap的源代码知道了工作原理之后，使用hashmap

```java
Map<Integer, String> map = new HashMap<>();
```

代码还是那个代码，但我已经知道了hashmap背后的东西

- 数据结构是链表的数组（注：后面的版本为了提升性能，已经是改成链表或者树（节点较多）了）
- 思想上是空间换时间的算法
- 构造函数上有容量和负载因子2个参数以及作用
- 决定性能的是key的hashcode是否够快、结果够分散（不分散就会变成链表的性能了），和扩容的开销（什么时候扩容，和负载因子有关）

然后写代码的时候，如果知道了最终的容量（尤其是数据量大的时候），我都会指定初始化容量，类似如下

```java
List<SomeBean> list = doSomeThing(); 
Map<Integer, String> map = new HashMap<>((int)(list.size()/0.75));//0.75为默认负载因子
```

如果工作中某个map使用特别多，性能还需要继续优化，我就会考虑从以下方面优化

- 如果key是自己定义的对象，那么hashcode方法是否够快（最少应该缓存保证只计算一次，而且放入之后不能改变，决定hashcode的字段不能改变）？ hash的结果是否够分散？
- 可以考虑调小负载因子，花更多的空间来换时间

学习源代码的时候，特别有意思，你会强烈感觉到一个词：**举一反三！触类旁通！** 学习api使用的时候，如果你只知道使用不知道原理，很难举一反三，感觉的是死记硬背。但学习了原理之后，知识成体系后，很容易举一反三，学的越多就容易，还是以hashmap为例，我举一个hashmap反三个点。

1. 你会知道但凡有数组的数据结构，构造函数都有一个容量的初始化参数（或者说构造函数有初始化容量的可能都是数组的数据结构）。构造函数如下

```java
public ArrayList(int initialCapacity) //LinkedList不是数组就没有
public HashMap(int initialCapacity) 
public StringBuffer(int capacity) 
```

你就会知道，数组扩容很耗性能（数据量大容易oom），尽量指定容量。

1. 算法是空间换时间，还有没有其他算法是这种思想的？你最少能找到一个桶排序。
2. 数据库的分库分表，思路和hashmap大同小异
3. 各种分布式的hash一致性算法，第一步都是创建一个最大的数组（Integer.MAX_VALUE）,就是避免了hashmap最耗性能的扩容运算。

学习了hashmap之后，你很自然就会去了解其他的map，如TreeMap，LinkedHashmap（超级有用），HashTable，ConcurrentSkipListMap（算法思路很有意思），ConcurrentHashMap等，你会知道set就是用map做的，都不需要学。到了这步，map相关就可以暂告一段落。

在学习中，我发现思想上的东西是最重要的，你理解了思想，一下子就豁然开朗了，在也不需要死记硬背了。如学习CAS的时候，大家都知道这是一种指令级的免锁实现。看代码的时候，我一度疑惑为什么会有个while死循环（原谅我天资驽钝）

```java
public final int getAndUpdate(IntUnaryOperator updateFunction) {
  int prev, next;
  do {
      prev = get();
      next = updateFunction.applyAsInt(prev);
  } while (!compareAndSet(prev, next));
  return prev;
}
```

后来从思想上理解，才知道乐观锁的概念，就是很乐观，假设你不会出错，但你要是出错了我就重试有办法给你修复，对应的就是悲观锁，就是很悲观，觉得不锁就会出错，如synchronize关键字和reentrantlock。这体现了2种不同截然不同的管理思想。这种思想经常体现在多个系统集成的设计，有些时候如果你用悲观的思想设计，实现起来很麻烦或者无法实现，但如果你用乐观的思想，减少出错条件，然后出错了能解决，代价就会小很多。

说了这么多，我想说的就是，j2ee的基础知识就是你做项目中代码背后的东西。提高自己水平的方法很简单，就是把大部分时间去了解实现原理，了解思想，让自己的知识串起来，形成体系。j2ee的知识特别多，学得人想哭，千万不要一开始把时间花在各种框架、组件的使用上，在我看来那是本末倒置。简单来说：先修内功再练招式。

**我觉得重要的、工作会用得到的知识就是一个请求从前台到后台处理的过程需要用到的东西**，最少包括以下点：js，html，css，ajax，ajax跨域，跨站脚本，web缓存，web优化，nginx，apache作用，鉴权方式，cookie，session，servlet，filter，基本数据结构，线程池，线程并发，缓存，io等等，知识点非常多。如你前台用jq，你应该了解他的选择器和ajax是如何实现的（其实去了解就会发现不复杂）？而不是只是会用。后台你用springmvc，你要了解他是如何工作，每一个配置是做什么，为什么？

j2ee知识点特别多，每一个都能写很多，我也在不断学习中。具体要写我还真不知道如何下手，我就列举一下我觉得基础的东西（面试的时候问的问题），有简单有难，你觉得偏可能是你没有做过这块的开发或者做得比较浅：

1. map有哪些，特点和使用场景？（只知道hashmap，hashtable是不够的。。。）
2. 哪些方面会影响hashmap的性能？
3. 线程安全的map有哪些，concurrenthashmap是如何实现线程安全的（jdk1.8大不同）？
4. 锁有哪几种？
5. 公平锁，读写锁等如何实现？
6. synchronize能加在哪些地方？什么区别？
7. 死锁的形成条件？现在很少死锁了，很少问
8. 原子数据对象的原理？
9. reentrantlock相关知识，condition如何使用？（很重要的知识点，强烈推荐阅读ArrayBlockingQueue源码，教科书般）
10. volatile的相关知识（内存屏障，重排）
11. ThreadLocal原理和使用？（超级有用的知识点，工作中使用很多，让代码漂亮很多，后面专门开贴写）
12. 多个线程同步等待？（CountDownLatch，CyclicBarrier，Semaphore信号量很多语言都有，实际上使用不是很多，线程池就可以实现大部分等待功能）
13. 线程池？（种类，重要的方法，这个一般是使用层面，简单）
14. 动态代理？反射？内省？（考察知识面）
15. session相关知识？和cookie关系？分布式session实现原理？
16. cookie相关知识？有哪些属性？（有些属性很有用，只是我们很少留意而已！）
17. nginx，apache 实际项目能做哪些？（鉴权，转发，缓存，反向代理等）和tomcat什么关系？最少了解
18. ajax跨域原因？解决方式？（重点知识，做SE避免不了的问题。这里很多知识点。）
19. jsonp原理？后台需要改动吗？（jsonp虽然现在落伍了，但还是会问问）
20. web优化知识点？（常规知识点）
21. 前台缓存相关？（200cache,304，ajax缓存，如何实现缓存）

一列举就根本停不下来了。。。其他的spring框架的东西也很多，还有jvm的东西，系统集成相关，数据库相关，io做得很少也不懂问，后面再慢慢把我的学习过程和偶得写下来。很多东西我也是了解个大概，就是看看你有没有学习过，不断学习是程序员最重要的特征。

我不算高手，只能算一个合格的老程序员。这里只是说了一下自己之前学习的方向和列举了几个学习中的例子，大家见仁见智。帖子也是针对迷茫的初学者有感而发，希望能帮助到大家。

**最后我总结一下：初学者先广在精，关注代码背后的实现，关注内功修炼，了解实现原理和思想，形成自己完整的技术体系，知识成片之后就容易触类旁通，进步的速度就会越来越快。最后以我在每一个项目组和开发人员聊天都会说的几个例子结尾：“少林功夫里面有功和拳之分，马步功，石锁功是功，蛇拳猴拳是拳，你不可能练会了蛇拳猴拳就能打人，你必须先重点练功。乔峰在聚贤庄用太祖长拳把大家打得落花流水，我们用太祖长拳就只是个广播体操。同样，我们要分清编程里面那些是功那些是拳，代码背后的实现和思想是功，各个框架、api使用是拳。初学者应该大部分时间花在练功上，功到了拳自然就有了，切勿本末倒置。”谢谢大家阅读！**